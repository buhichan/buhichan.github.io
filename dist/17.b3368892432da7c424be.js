(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"./src/routes/shougi/index.tsx":function(t,e,n){"use strict";n.r(e);var o,r=n("react");!function(t){t[t.Ou=0]="Ou",t[t.Gyou=1]="Gyou"}(o||(o={}));const i=9;class s{constructor(t,e){this.x=t,this.y=e}static newCoord(t,e){return t<0||t>=i||e<0||t>=i?null:new s(t,e)}eq(t){return t.x===this.x&&t.y===this.y}topleft(){return new s(this.x-1,this.y+1)}topright(){return new s(this.x+1,this.y+1)}bottomleft(){return new s(this.x-1,this.y-1)}bottomright(){return new s(this.x+1,this.y-1)}top(){return new s(this.x,this.y+1)}left(){return new s(this.x-1,this.y)}right(){return new s(this.x+1,this.y)}bottom(){return new s(this.x,this.y-1)}}var a,u,c,h;!function(t){t[t["飞车"]=0]="飞车",t[t["龙王"]=1]="龙王",t[t["王将"]=2]="王将",t[t["玉将"]=3]="玉将",t[t["角行"]=4]="角行",t[t["龙马"]=5]="龙马",t[t["香车"]=6]="香车",t[t["成香"]=7]="成香",t[t["银将"]=8]="银将",t[t["成银"]=9]="成银",t[t["金将"]=10]="金将",t[t["桂马"]=11]="桂马",t[t["成桂"]=12]="成桂",t[t["步兵"]=13]="步兵",t[t["成步"]=14]="成步"}(a||(a={})),function(t){t[t.Eat=0]="Eat",t[t.Move=1]="Move",t[t.Uchikomu=2]="Uchikomu"}(u||(u={}));class l{constructor(t,e,n){this.koma=t,this.from=e,this.to=n}}class d{constructor(t,e,n){this.koma=t,this.from=e,this.to=n}}class g{constructor(t,e,n){this.koma=t,this.from=e,this.to=n}}!function(t){t[t.MayUpgrade=0]="MayUpgrade",t[t.KO=1]="KO",t[t.Nothing=2]="Nothing"}(c||(c={})),function(t){t[t.CannotUpgrade=0]="CannotUpgrade",t[t.MustUpgrade=1]="MustUpgrade",t[t.MayUpgrade=2]="MayUpgrade"}(h||(h={}));class f{constructor(t){this.faction=t}downgrade(){return this}canUchiKomu(t,e){return!0}}function m(t,e){return t===o.Ou?i-e.y:e.y+1}function w(t,e,n,o,r){let i=[],a=n.x,u=n.y,c=1e3;for(;;){if(0===--c){console.error("Infinite loop");break}a+=o,u+=r;const h=s.newCoord(a,u);if(!h)break;{const o=t.createMove(e,n,h);if(!o)break;if(o instanceof d){i.push(o);break}i.push(o)}}return i}class y extends f{getPossibleMoves(t,e){return[e.createMove(this,t,t.left()),e.createMove(this,t,t.top()),e.createMove(this,t,t.bottom()),e.createMove(this,t,t.right()),e.createMove(this,t,t.topleft()),e.createMove(this,t,t.topright()),e.createMove(this,t,t.bottomleft()),e.createMove(this,t,t.bottomright())].filter(t=>null!==t)}getPossibleUpgrade(){return{kind:h.CannotUpgrade}}canUchiKomu(){return!1}get kind(){return this.faction===o.Ou?a.王将:a.玉将}get name(){return this.faction===o.Ou?"王将":"玉将"}}class p extends f{getPossibleMoves(t,e){return[...w(e,this,t,0,1),...w(e,this,t,0,-1),...w(e,this,t,1,0),...w(e,this,t,-1,0)].filter(t=>null!==t)}getPossibleUpgrade(t){return m(this.faction,t)<=3?{kind:h.MayUpgrade,to:new b(this.faction)}:{kind:h.CannotUpgrade}}get kind(){return a.飞车}get name(){return"飞车"}}class b extends f{getPossibleMoves(t,e){return[...w(e,this,t,0,1),...w(e,this,t,0,-1),...w(e,this,t,1,0),...w(e,this,t,-1,0),e.createMove(this,t,t.topleft()),e.createMove(this,t,t.topright()),e.createMove(this,t,t.bottomleft()),e.createMove(this,t,t.bottomright())].filter(t=>null!==t)}getPossibleUpgrade(){return{kind:h.CannotUpgrade}}downgrade(){return new p(this.faction)}get kind(){return a.龙王}get name(){return"龙王"}}class k extends f{getPossibleMoves(t,e){return[...w(e,this,t,1,-1),...w(e,this,t,-1,1),...w(e,this,t,1,1),...w(e,this,t,-1,-1)].filter(t=>null!==t)}getPossibleUpgrade(t){return m(this.faction,t)<=3?{kind:h.MayUpgrade,to:new M(this.faction)}:{kind:h.CannotUpgrade}}get kind(){return a.角行}get name(){return"角行"}}class M extends f{getPossibleMoves(t,e){return[...w(e,this,t,1,-1),...w(e,this,t,-1,1),...w(e,this,t,1,1),...w(e,this,t,-1,-1),e.createMove(this,t,t.top()),e.createMove(this,t,t.right()),e.createMove(this,t,t.left()),e.createMove(this,t,t.bottom())].filter(t=>null!==t)}downgrade(){return new k(this.faction)}getPossibleUpgrade(t){return{kind:h.CannotUpgrade}}get kind(){return a.龙马}get name(){return"龙马"}}class v extends f{getPossibleMoves(t,e){return[e.createMove(this,t,t.top()),e.createMove(this,t,t.right()),e.createMove(this,t,t.left()),e.createMove(this,t,t.bottom()),...this.faction===o.Ou?[e.createMove(this,t,t.topleft()),e.createMove(this,t,t.topright())]:[e.createMove(this,t,t.bottomleft()),e.createMove(this,t,t.bottomright())]].filter(t=>null!==t)}getPossibleUpgrade(){return{kind:h.CannotUpgrade}}get kind(){return a.金将}get name(){return"金将"}}class x extends f{getPossibleMoves(t,e){return[e.createMove(this,t,t.topleft()),e.createMove(this,t,t.topright()),e.createMove(this,t,t.bottomleft()),e.createMove(this,t,t.bottomright()),...this.faction===o.Ou?[e.createMove(this,t,t.top())]:[e.createMove(this,t,t.bottom())]].filter(t=>null!==t)}getPossibleUpgrade(t){return m(this.faction,t)<=3?{kind:h.MayUpgrade,to:new U(this.faction)}:{kind:h.CannotUpgrade}}get kind(){return a.银将}get name(){return"银将"}}class U extends v{get kind(){return a.成银}downgrade(){return new x(this.faction)}get name(){return"成银"}}class O extends f{getPossibleMoves(t,e){let n=this.faction===o.Ou?1:-1;return[e.createMove(this,t,s.newCoord(t.x-1,t.y+2*n)),e.createMove(this,t,s.newCoord(t.x+1,t.y+2*n))].filter(t=>null!==t)}getPossibleUpgrade(t){const e=m(this.faction,t);return e<=2?{kind:h.MustUpgrade,to:new G(this.faction)}:e<=3?{kind:h.MayUpgrade,to:new G(this.faction)}:{kind:h.CannotUpgrade}}canUchiKomu(t){return this.faction===o.Ou?t.y<=i-3:t.y>=2}get kind(){return a.桂马}get name(){return"桂马"}}class G extends v{get kind(){return a.成桂}downgrade(){return new O(this.faction)}get name(){return"成桂"}}class K extends f{getPossibleMoves(t,e){return[...w(e,this,t,0,this.faction===o.Ou?1:-1)].filter(t=>null!==t)}getPossibleUpgrade(t){const e=m(this.faction,t);return e<=1?{kind:h.MustUpgrade,to:new P(this.faction)}:e<=3?{kind:h.MayUpgrade,to:new P(this.faction)}:{kind:h.CannotUpgrade}}canUchiKomu(t){return this.faction===o.Ou?t.y<=i-2:t.y>=1}get kind(){return a.香车}get name(){return"香车"}}class P extends v{get kind(){return a.成香}downgrade(){return new K(this.faction)}get name(){return"成香"}}class C extends f{getPossibleMoves(t,e){return[e.createMove(this,t,this.faction===o.Ou?t.top():t.bottom())].filter(t=>null!==t)}getPossibleUpgrade(t){return m(this.faction,t)<=1?{kind:h.MustUpgrade,to:new E(this.faction)}:m(this.faction,t)<=3?{kind:h.MayUpgrade,to:new E(this.faction)}:{kind:h.CannotUpgrade}}canUchiKomu(t,e){const n=this.faction===o.Ou?t.y<=i-2:t.y>=1,r=new Array(i).fill(0).every((n,o)=>{if(o===t.y)return!0;const r=e.getKoma(s.newCoord(t.x,o));return!r||r.faction!==this.faction||r.kind!==a.步兵}),u=e.getKoma(this.faction===o.Ou?t.top():t.bottom()),c=!u||u.faction===this.faction||u.kind!==a.王将&&u.kind!==a.玉将;return r&&n&&c}get kind(){return a.步兵}get name(){return"步兵"}}class E extends v{get kind(){return a.成步}get name(){return"成步"}}class A{constructor(){this.tomb={[o.Gyou]:[],[o.Ou]:[]},this.board=[]}init(){this.tomb[o.Gyou]=[],this.tomb[o.Ou]=[],this.board=new Array(i*i).fill(null),this.board.splice(0,i,new K(o.Ou),new O(o.Ou),new x(o.Ou),new v(o.Ou),new y(o.Ou),new v(o.Ou),new x(o.Ou),new O(o.Ou),new K(o.Ou)),this.board[i+1]=new k(o.Ou),this.board[2*i-2]=new p(o.Ou),this.board.splice(2*i,i,new C(o.Ou),new C(o.Ou),new C(o.Ou),new C(o.Ou),new C(o.Ou),new C(o.Ou),new C(o.Ou),new C(o.Ou),new C(o.Ou)),this.board.splice(i*(i-1),i,new K(o.Gyou),new O(o.Gyou),new x(o.Gyou),new v(o.Gyou),new y(o.Gyou),new v(o.Gyou),new x(o.Gyou),new O(o.Gyou),new K(o.Gyou)),this.board[i*(i-2)+1]=new p(o.Gyou),this.board[i*(i-1)-2]=new k(o.Gyou),this.board.splice(i*(i-3),i,new C(o.Gyou),new C(o.Gyou),new C(o.Gyou),new C(o.Gyou),new C(o.Gyou),new C(o.Gyou),new C(o.Gyou),new C(o.Gyou),new C(o.Gyou))}getKoma(t){return this.board[t.y*i+t.x]}killKoma(t){const e=this.board[t.y*i+t.x];if(!e)throw new Error("Illegal Move!");return delete this.board[t.y*i+t.x],this.tomb[e.faction].push(e),e}moveKoma(t,e){this.board[e.y*i+e.x]=this.board[t.y*i+t.x],this.board[t.y*i+t.x]=null}upgradeKoma(t){const{to:e}=this.getKoma(t).getPossibleUpgrade(t);this.board[t.y*i+t.x]=e}performMove(t){const e=this.getKoma(t.from);let n=!0;switch(!0){case t instanceof l:this.moveKoma(t.from,t.to);break;case t instanceof d:{const e=this.killKoma(t.to);if(this.moveKoma(t.from,t.to),e.kind===a.玉将||e.kind===a.王将)return c.KO;break}case t instanceof g:{n=!1;const e=t.to,o=t.koma;if(this.board[e.y*i+e.x])throw new Error("Invalid Action");const r=this.tomb[o.faction].findIndex(t=>t.kind===o.kind);if(-1===r)throw new Error("Invalid Action");const[s]=this.tomb[o.faction].splice(r,1);this.board[e.y*i+e.x]=s;break}}if(n){const n=e.getPossibleUpgrade(t.to);if(n.kind===h.MustUpgrade)this.upgradeKoma(t.to);else if(n.kind===h.MayUpgrade)return c.MayUpgrade}return c.Nothing}createMove(t,e,n){if(!n)return null;const o=this.getKoma(n);return o?o.faction!==t.faction?new d(t,e,n):null:new l(t,e,n)}}function S(t){const[e,n]=r.useState(null),[a,u]=r.useState([]),h=r.useMemo(()=>{const t=new A;return t.init(),t},[]),[l,d]=r.useState(o.Ou),[f,m]=r.useState(0),[w,y]=r.useState(null),p=()=>{m(f+1)};return r.createElement(r.Fragment,null,r.createElement("p",null,"当前回合: 「",l===o.Ou?"王将":"玉将","」"),r.createElement("div",{style:{width:50*i}},new Array(i).fill(0).map((t,f)=>{const m=i-1-f;return r.createElement("div",{key:m,style:{display:"flex"}},new Array(i).fill(0).map((t,i)=>{const f=s.newCoord(i,m),b=h.getKoma(f),k=w&&!b&&w.canUchiKomu(f,h)?new g(w,f,f):a.find(t=>t.to.eq(f));return r.createElement("div",{onClick:()=>{if(k){switch(h.performMove(k)){case c.KO:return alert((l===o.Ou?"王将":"玉将")+"方获胜!"),h.init(),n(null),u([]),d(l===o.Ou?o.Gyou:o.Ou),void p();case c.MayUpgrade:confirm("是否升级棋子?")&&h.upgradeKoma(f)}n(null),u([]),y(null),d(l===o.Ou?o.Gyou:o.Ou),p()}else if(b&&b.faction===l){n(f);const t=b.getPossibleMoves(f,h);u(t),y(null)}},key:i,style:{display:"inline-flex",border:".5px solid #999",cursor:"pointer",width:50,height:50,transform:b&&b.faction===o.Gyou?"rotate(180deg)":void 0,justifyContent:"center",alignItems:"center",color:e&&e.eq(f)?"#00f9":void 0,background:k?"#0f03":void 0}},b&&r.createElement(I,{koma:b}))}))})),r.createElement("div",null,"墓地:",r.createElement("div",{style:{width:50*i/2,display:"inline-block"}},"王:",h.tomb[o.Ou].map((t,e)=>r.createElement("button",{onClick:()=>{y(t)},key:e},t.name))),r.createElement("div",{style:{width:50*i/2,display:"inline-block"}},"玉:",h.tomb[o.Gyou].map((t,e)=>r.createElement("button",{onClick:()=>{y(t)},key:e},t.name)))))}function I({koma:t}){const e=t.name;return r.createElement("svg",{width:50,height:50,viewBox:"0 0 50 50"},r.createElement("path",{stroke:"#000",fill:"#0000",d:"M 5, 45 L 45, 45 L 40, 15 L 25 5 L 10, 15 L 5, 45"}),r.createElement("text",{textAnchor:"middle",fontSize:16,x:25,y:24},e[0]),r.createElement("text",{textAnchor:"middle",fontSize:16,x:25,y:42},e[1]))}n.d(e,"default",function(){return S})}}]);