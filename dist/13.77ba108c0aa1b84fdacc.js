(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"./src/routes/demos/emoji-player/index.tsx":function(e,t,n){"use strict";n.r(t);var r=n("react"),a=n("./node_modules/rxjs/_esm5/internal/Subject.js"),s=function(e,t,n,r){return new(n||(n=Promise))(function(a,s){function l(e){try{o(r.next(e))}catch(e){s(e)}}function i(e){try{o(r.throw(e))}catch(e){s(e)}}function o(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(l,i)}o((r=r.apply(e,t||[])).next())})};function l(e,t,n){const r=document.createElement("img");return r.src=URL.createObjectURL(e),new Promise(e=>{r.onload=()=>{const a=r.width/t,s=r.height/t;n.height=r.height,n.width=r.width;const l=n.getContext("2d");l.drawImage(r,0,0);let i=[];for(let e=0;e<s;e++){let n=[];for(let r=0;r<a;r++){const a=l.getImageData(r*t,e*t,1,1);n.push(a.data)}i.push(n)}e(i)}})}const i=["🧑🏿","🧑🏾","🧑🏽","🧑🏼","🧑🏻"];let o=30,u=30;function c(e){const[t,n]=r.useState([]),[c,f]=r.useState(`-ss 00:00:00 -i input.webm -vframes ${o*u} output-%03d.jpg`),p=r.useRef(null),d=e=>{p.current&&(p.current.innerHTML=e)},m=r.useRef(null);return r.useEffect(()=>{if(!e.file||!c)return;n([]),d("loading..., please wait.");const{output:t,files:r}=function(e,t){const n=e.type,[r,s]=n.split("/"),l=new a.a,i=new a.a;return function(e){return new Promise((t,n)=>{const r=new FileReader;r.readAsArrayBuffer(e),r.onload=()=>{t(r.result)},r.onerror=n})}(e).then(e=>{var n=new Uint8Array(e);let r="webm"===s?new Worker("assets/ffmpeg.js/ffmpeg-worker-webm.js"):"mp4"===s?new Worker("assets/ffmpeg.js/ffmpeg-worker-mp4.js"):null;if(!r)return[];r.postMessage({type:"run",MEMFS:[{name:`input.${s}`,data:n}],arguments:t.concat("-hide_banner")});r.addEventListener("message",e=>{"exit"===e.data.type||("done"===e.data.type?(i.next(e.data.data.MEMFS),r.terminate(),i.complete(),l.complete()):l.next(e.data))})}),{output:l,files:i}}(e.file,c.split(" ")),u=t.pipe().subscribe(e=>{if(e.data&&e.data.startsWith("frame=")){const[t,n]=e.data.split(/\s+/g);d(`${n}/900`)}});return r.subscribe(e=>s(this,void 0,void 0,function*(){console.log(`got ${e.length} images`);let t=[],n=null;for(let r in e){const a=e[r],s=new Blob([a.data],{type:"image/jpeg"}),u=yield l(s,20,m.current);if(t.push(u.map(e=>e.map(e=>{const t=2*(.2126*e[0]/255+.7152*e[1]/255+.0722*e[2]/255);return i[Math.min(Math.floor(t*i.length),i.length-1)]}).join("")).join("\n")),null===n){n=0;let r=setInterval(()=>{n>t.length-1?d(t[t.length-1]):(d(t[t.length-1]),n++),n===e.length&&clearInterval(r)},1e3/o)}}})),()=>u.unsubscribe()},[e.file,c]),r.createElement("div",null,"Can Only Play the first 900 frames.",r.createElement("div",null),r.createElement("style",null,".pixel{\n                display:inline-block;\n                width:10px;\n                height:10px;\n            }"),r.createElement("div",{ref:p,style:{whiteSpace:"pre-wrap"}}),r.createElement("canvas",{ref:m}))}function f(){const[e,t]=r.useState(null);return r.useEffect(()=>{fetch("assets/big_buck_bunny.webm").then(e=>e.blob()).then(t)},[]),r.createElement("div",null,r.createElement("input",{type:"file",accept:"video/webm",onChange:e=>{if(!e.currentTarget.files)return;const n=e.currentTarget.files[0];n&&t(n)}}),e?r.createElement(c,{file:e}):null)}n.d(t,"default",function(){return f})}}]);
//# sourceMappingURL=13.77ba108c0aa1b84fdacc.js.map