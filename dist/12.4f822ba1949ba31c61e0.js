(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"./src/routes/demos/emoji-player/index.tsx":function(e,t,n){"use strict";n.r(t);var r=n("react"),a=n("./node_modules/rxjs/_esm5/internal/Subject.js");function s(e,t,n){const r=document.createElement("img");return r.src=URL.createObjectURL(e),new Promise(e=>{r.onload=()=>{const a=r.width/t,s=r.height/t;n.height=r.height,n.width=r.width;const l=n.getContext("2d");l.drawImage(r,0,0);let i=[];for(let e=0;e<s;e++){let n=[];for(let r=0;r<a;r++){const a=l.getImageData(r*t,e*t,1,1);n.push(a.data)}i.push(n)}e(i)}})}const l=["🧑🏿","🧑🏾","🧑🏽","🧑🏼","🧑🏻"];let i=30,u=30;function o(e){const[t,n]=r.useState([]),[o,c]=r.useState(`-ss 00:00:00 -i input.webm -vframes ${i*u} output-%03d.jpg`),f=r.useRef(null),p=e=>{f.current&&(f.current.innerHTML=e)},m=r.useRef(null);return r.useEffect(()=>{if(!e.file||!o)return;n([]),p("loading..., please wait.");const{output:t,files:r}=function(e,t){const n=e.type,[r,s]=n.split("/"),l=new a.a,i=new a.a;return function(e){return new Promise((t,n)=>{const r=new FileReader;r.readAsArrayBuffer(e),r.onload=()=>{t(r.result)},r.onerror=n})}(e).then(e=>{var n=new Uint8Array(e);let r="webm"===s?new Worker("assets/ffmpeg.js/ffmpeg-worker-webm.js"):"mp4"===s?new Worker("assets/ffmpeg.js/ffmpeg-worker-mp4.js"):null;if(!r)return[];r.postMessage({type:"run",MEMFS:[{name:`input.${s}`,data:n}],arguments:t.concat("-hide_banner")});r.addEventListener("message",e=>{"exit"===e.data.type||("done"===e.data.type?(i.next(e.data.data.MEMFS),r.terminate(),i.complete(),l.complete()):l.next(e.data))})}),{output:l,files:i}}(e.file,o.split(" ")),u=t.pipe().subscribe(e=>{if(e.data&&e.data.startsWith("frame=")){const[t,n]=e.data.split(/\s+/g);p(`${n}/900`)}});return r.subscribe(async e=>{console.log(`got ${e.length} images`);let t=[],n=null;for(let r in e){const a=e[r],u=new Blob([a.data],{type:"image/jpeg"}),o=await s(u,20,m.current);if(t.push(o.map(e=>e.map(e=>{const t=2*(.2126*e[0]/255+.7152*e[1]/255+.0722*e[2]/255);return l[Math.min(Math.floor(t*l.length),l.length-1)]}).join("")).join("\n")),null===n){n=0;let r=setInterval(()=>{n>t.length-1?p(t[t.length-1]):(p(t[t.length-1]),n++),n===e.length&&clearInterval(r)},1e3/i)}}}),()=>u.unsubscribe()},[e.file,o]),r.createElement("div",null,"Can Only Play the first 900 frames.",r.createElement("div",null),r.createElement("style",null,".pixel{\n                display:inline-block;\n                width:10px;\n                height:10px;\n            }"),r.createElement("div",{ref:f,style:{whiteSpace:"pre-wrap"}}),r.createElement("canvas",{ref:m}))}function c(){const[e,t]=r.useState(null);return r.useEffect(()=>{fetch("assets/big_buck_bunny.webm").then(e=>e.blob()).then(t)},[]),r.createElement("div",null,r.createElement("input",{type:"file",accept:"video/webm",onChange:e=>{if(!e.currentTarget.files)return;const n=e.currentTarget.files[0];n&&t(n)}}),e?r.createElement(o,{file:e}):null)}n.d(t,"default",function(){return c})}}]);
//# sourceMappingURL=12.4f822ba1949ba31c61e0.js.map