(window.webpackJsonp=window.webpackJsonp||[]).push([[13],{"./src/routes/demos/emoji-player/index.tsx":function(e,t,n){"use strict";n.r(t);var r=n("react"),a=n("./node_modules/rxjs/_esm5/internal/Subject.js");const s=document.createElement("canvas"),l=document.querySelector("#content");function i(e,t){const n=document.createElement("img");return n.src=URL.createObjectURL(e),new Promise(e=>{n.onload=()=>{const r=n.width/t,a=n.height/t;s.height=n.height,s.width=n.width;const l=s.getContext("2d");l.drawImage(n,0,0);let i=[];for(let e=0;e<a;e++){let n=[];for(let a=0;a<r;a++){const r=l.getImageData(a*t,e*t,1,1);n.push(r.data)}i.push(n)}e(i)}})}l&&l.append(s);const o=["🧑🏿","🧑🏾","🧑🏽","🧑🏼","🧑🏻"];let u=30,c=30;function p(e){const[t,n]=r.useState([]),[s,l]=r.useState(`-ss 00:00:00 -i input.webm -vframes ${u*c} output-%03d.jpg`),p=r.useRef(null),f=e=>{p.current&&(p.current.innerHTML=e)};return r.useEffect(()=>{if(!e.file||!s)return;n([]),f("loading..., please wait.");const{output:t,files:r}=function(e,t){const n=e.type,[r,s]=n.split("/"),l=new a.a,i=new a.a;return function(e){return new Promise((t,n)=>{const r=new FileReader;r.readAsArrayBuffer(e),r.onload=()=>{t(r.result)},r.onerror=n})}(e).then(e=>{var n=new Uint8Array(e);let r="webm"===s?new Worker("assets/ffmpeg.js/ffmpeg-worker-webm.js"):"mp4"===s?new Worker("assets/ffmpeg.js/ffmpeg-worker-mp4.js"):null;if(!r)return[];r.postMessage({type:"run",MEMFS:[{name:`input.${s}`,data:n}],arguments:t.concat("-hide_banner")});r.addEventListener("message",e=>{"exit"===e.data.type||("done"===e.data.type?(i.next(e.data.data.MEMFS),r.terminate(),i.complete(),l.complete()):l.next(e.data))})}),{output:l,files:i}}(e.file,s.split(" ")),l=t.pipe().subscribe(e=>{if(e.data&&e.data.startsWith("frame=")){const[t,n]=e.data.split(/\s+/g);f(`${n}/900`)}});return r.subscribe(async e=>{console.log(`got ${e.length} images`);let t=[],n=null;for(let r in e){const a=e[r],s=new Blob([a.data],{type:"image/jpeg"}),l=await i(s,20);if(t.push(l.map(e=>e.map(e=>{const t=2*(.2126*e[0]/255+.7152*e[1]/255+.0722*e[2]/255);return o[Math.min(Math.floor(t*o.length),o.length-1)]}).join("")).join("\n")),null===n){n=0;let r=setInterval(()=>{n>t.length-1?f(t[t.length-1]):(f(t[t.length-1]),n++),n===e.length&&clearInterval(r)},1e3/u)}}}),()=>l.unsubscribe()},[e.file,s]),r.createElement("div",null,"Can Only Play the first 900 frames.",r.createElement("div",null),r.createElement("style",null,".pixel{\n                display:inline-block;\n                width:10px;\n                height:10px;\n            }"),r.createElement("div",{ref:p,style:{whiteSpace:"pre-wrap"}}))}function f(){const[e,t]=r.useState(null);return r.useEffect(()=>{fetch("assets/big_buck_bunny.webm").then(e=>e.blob()).then(t)},[]),r.createElement("div",null,r.createElement("input",{type:"file",accept:"video/webm",onChange:e=>{if(!e.currentTarget.files)return;const n=e.currentTarget.files[0];n&&t(n)}}),e?r.createElement(p,{file:e}):null)}n.d(t,"default",function(){return f})}}]);
//# sourceMappingURL=13.5a699f999725acbba047.js.map